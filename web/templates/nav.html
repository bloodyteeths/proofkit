<!-- ProofKit Navigation Component -->
{% from 'macros/navigation.html' import is_active_nav, nav_class, nav_link, is_industry_active, dropdown_toggle_class, is_home_page %}
<nav role="navigation" aria-label="Main navigation" style="position: sticky; top: 0; z-index: 1000; background: var(--primary-gradient); backdrop-filter: blur(10px); box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);">
    <div class="container" style="display: flex; align-items: center; justify-content: space-between; padding: 0.75rem 1rem;">
        
        <!-- Logo/Brand Section -->
        <div class="nav-brand">
            <a href="/" aria-label="ProofKit Home" style="color: white; text-decoration: none; font-size: 1.5rem; font-weight: 700; display: flex; align-items: center; gap: 0.5rem;">
                <span style="background: rgba(255, 255, 255, 0.1); padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-family: monospace;">PK</span>
                ProofKit
            </a>
        </div>

        <!-- Primary Navigation -->
        <div class="nav-primary" style="display: flex; align-items: center; gap: 1.5rem;">
            
            <!-- Industries Dropdown -->
            <div class="nav-dropdown" style="position: relative;">
                <button 
                    type="button" 
                    class="{{ dropdown_toggle_class(request, ['powder-coat', 'haccp', 'autoclave', 'sterile-eto', 'concrete', 'cold-chain'], 'nav-dropdown-toggle') }}" 
                    aria-expanded="false" 
                    aria-haspopup="true"
                    aria-controls="industries-menu"
                    style="background: rgba(255, 255, 255, 0.1); color: white; border: 1px solid rgba(255, 255, 255, 0.2); padding: 0.5rem 1rem; border-radius: 0.375rem; cursor: pointer; display: flex; align-items: center; gap: 0.5rem; font-weight: 500; transition: all 0.2s ease;"
                    onmouseover="this.style.background='rgba(255, 255, 255, 0.2)'"
                    onmouseout="this.style.background='rgba(255, 255, 255, 0.1)'"
                    onclick="toggleDropdown('industries-menu', this)">
                    Industries
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" style="transition: transform 0.2s ease;" class="dropdown-arrow">
                        <path d="M4.427 6.427a.75.75 0 0 1 1.06 0L8 8.94l2.513-2.513a.75.75 0 1 1 1.06 1.06l-3 3a.75.75 0 0 1-1.06 0l-3-3a.75.75 0 0 1 0-1.06z"/>
                    </svg>
                </button>
                
                <div 
                    id="industries-menu" 
                    class="nav-dropdown-menu" 
                    role="menu"
                    aria-labelledby="industries-dropdown"
                    style="position: absolute; top: 100%; right: 0; margin-top: 0.5rem; background: white; border-radius: 0.5rem; box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15); min-width: 220px; opacity: 0; visibility: hidden; transform: translateY(-10px); transition: all 0.2s ease; z-index: 1001;">
                    
                    <div style="padding: 0.5rem;">
                        <a href="/app?industry=powder-coat" 
                           role="menuitem" 
                           class="{{ nav_class(request, '/app', 'powder-coat', 'nav-dropdown-item') }}"
                           style="display: block; padding: 0.75rem 1rem; color: #374151; text-decoration: none; border-radius: 0.375rem; transition: background-color 0.2s ease; font-weight: 500;"
                           onmouseover="this.style.backgroundColor='#f3f4f6'"
                           onmouseout="this.style.backgroundColor='transparent'">
                            üé® Powder-Coat
                        </a>
                        
                        <a href="/app?industry=haccp" 
                           role="menuitem" 
                           class="{{ nav_class(request, '/app', 'haccp', 'nav-dropdown-item') }}"
                           style="display: block; padding: 0.75rem 1rem; color: #374151; text-decoration: none; border-radius: 0.375rem; transition: background-color 0.2s ease; font-weight: 500;"
                           onmouseover="this.style.backgroundColor='#f3f4f6'"
                           onmouseout="this.style.backgroundColor='transparent'">
                            üçΩÔ∏è HACCP
                        </a>
                        
                        <a href="/app?industry=autoclave" 
                           role="menuitem" 
                           class="{{ nav_class(request, '/app', 'autoclave', 'nav-dropdown-item') }}"
                           style="display: block; padding: 0.75rem 1rem; color: #374151; text-decoration: none; border-radius: 0.375rem; transition: background-color 0.2s ease; font-weight: 500;"
                           onmouseover="this.style.backgroundColor='#f3f4f6'"
                           onmouseout="this.style.backgroundColor='transparent'">
                            üè• Autoclave
                        </a>
                        
                        <a href="/app?industry=sterile-eto" 
                           role="menuitem" 
                           class="{{ nav_class(request, '/app', 'sterile-eto', 'nav-dropdown-item') }}"
                           style="display: block; padding: 0.75rem 1rem; color: #374151; text-decoration: none; border-radius: 0.375rem; transition: background-color 0.2s ease; font-weight: 500;"
                           onmouseover="this.style.backgroundColor='#f3f4f6'"
                           onmouseout="this.style.backgroundColor='transparent'">
                            üß™ Sterile EtO
                        </a>
                        
                        <a href="/app?industry=concrete" 
                           role="menuitem" 
                           class="{{ nav_class(request, '/app', 'concrete', 'nav-dropdown-item') }}"
                           style="display: block; padding: 0.75rem 1rem; color: #374151; text-decoration: none; border-radius: 0.375rem; transition: background-color 0.2s ease; font-weight: 500;"
                           onmouseover="this.style.backgroundColor='#f3f4f6'"
                           onmouseout="this.style.backgroundColor='transparent'">
                            üèóÔ∏è Concrete
                        </a>
                        
                        <a href="/app?industry=cold-chain" 
                           role="menuitem" 
                           class="{{ nav_class(request, '/app', 'cold-chain', 'nav-dropdown-item') }}"
                           style="display: block; padding: 0.75rem 1rem; color: #374151; text-decoration: none; border-radius: 0.375rem; transition: background-color 0.2s ease; font-weight: 500;"
                           onmouseover="this.style.backgroundColor='#f3f4f6'"
                           onmouseout="this.style.backgroundColor='transparent'">
                            ‚ùÑÔ∏è Cold-Chain
                        </a>
                    </div>
                </div>
            </div>
            
            <!-- App Link -->
            <a href="/app" 
               class="{{ nav_class(request, '/app', base_classes='nav-link') }}"
               style="color: rgba(255, 255, 255, 0.9); text-decoration: none; padding: 0.5rem 0.75rem; border-radius: 0.375rem; font-weight: 500; transition: all 0.2s ease;"
               onmouseover="this.style.color='white'; this.style.backgroundColor='rgba(255, 255, 255, 0.1)'"
               onmouseout="this.style.color='rgba(255, 255, 255, 0.9)'; this.style.backgroundColor='transparent'">
                ‚ö° App
            </a>

            <!-- Secondary Navigation Links -->
            <div class="nav-secondary" style="display: flex; align-items: center; gap: 1rem;">
                <a href="/blog" 
                   class="{{ nav_class(request, '/blog', base_classes='nav-link', exact_match=False) }}"
                   style="color: rgba(255, 255, 255, 0.9); text-decoration: none; padding: 0.5rem 0.75rem; border-radius: 0.375rem; font-weight: 500; transition: all 0.2s ease;"
                   onmouseover="this.style.color='white'; this.style.backgroundColor='rgba(255, 255, 255, 0.1)'"
                   onmouseout="this.style.color='rgba(255, 255, 255, 0.9)'; this.style.backgroundColor='transparent'">
                    üìù Blog
                </a>
                
                <a href="/examples" 
                   class="{{ nav_class(request, '/examples', base_classes='nav-link') }}"
                   style="color: rgba(255, 255, 255, 0.9); text-decoration: none; padding: 0.5rem 0.75rem; border-radius: 0.375rem; font-weight: 500; transition: all 0.2s ease;"
                   onmouseover="this.style.color='white'; this.style.backgroundColor='rgba(255, 255, 255, 0.1)'"
                   onmouseout="this.style.color='rgba(255, 255, 255, 0.9)'; this.style.backgroundColor='transparent'">
                    Examples
                </a>
                
                <a href="/docs" 
                   class="{{ nav_class(request, '/docs', base_classes='nav-link') }}"
                   style="color: rgba(255, 255, 255, 0.9); text-decoration: none; padding: 0.5rem 0.75rem; border-radius: 0.375rem; font-weight: 500; transition: all 0.2s ease;"
                   onmouseover="this.style.color='white'; this.style.backgroundColor='rgba(255, 255, 255, 0.1)'"
                   onmouseout="this.style.color='rgba(255, 255, 255, 0.9)'; this.style.backgroundColor='transparent'">
                    Docs
                </a>
                
                <a href="/pricing" 
                   class="{{ nav_class(request, '/pricing', base_classes='nav-link') }}"
                   style="color: rgba(255, 255, 255, 0.9); text-decoration: none; padding: 0.5rem 0.75rem; border-radius: 0.375rem; font-weight: 500; transition: all 0.2s ease;"
                   onmouseover="this.style.color='white'; this.style.backgroundColor='rgba(255, 255, 255, 0.1)'"
                   onmouseout="this.style.color='rgba(255, 255, 255, 0.9)'; this.style.backgroundColor='transparent'">
                    üí∞ Pricing
                </a>
                
                <!-- Trust Dropdown -->
                <div class="nav-dropdown" style="position: relative;">
                    <button 
                        type="button" 
                        class="{{ dropdown_toggle_class(request, ['trust', 'legal/privacy', 'legal/terms', 'legal/imprint'], 'nav-dropdown-toggle') }}" 
                        aria-expanded="false" 
                        aria-haspopup="true"
                        aria-controls="trust-menu"
                        style="background: rgba(255, 255, 255, 0.1); color: white; border: 1px solid rgba(255, 255, 255, 0.2); padding: 0.5rem 1rem; border-radius: 0.375rem; cursor: pointer; display: flex; align-items: center; gap: 0.5rem; font-weight: 500; transition: all 0.2s ease;"
                        onmouseover="this.style.background='rgba(255, 255, 255, 0.2)'"
                        onmouseout="this.style.background='rgba(255, 255, 255, 0.1)'"
                        onclick="toggleDropdown('trust-menu', this)">
                        Trust
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" style="transition: transform 0.2s ease;" class="dropdown-arrow">
                            <path d="M4.427 6.427a.75.75 0 0 1 1.06 0L8 8.94l2.513-2.513a.75.75 0 1 1 1.06 1.06l-3 3a.75.75 0 0 1-1.06 0l-3-3a.75.75 0 0 1 0-1.06z"/>
                        </svg>
                    </button>
                    
                    <div 
                        id="trust-menu" 
                        class="nav-dropdown-menu" 
                        role="menu"
                        aria-labelledby="trust-dropdown"
                        style="position: absolute; top: 100%; right: 0; margin-top: 0.5rem; background: white; border-radius: 0.5rem; box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15); min-width: 200px; opacity: 0; visibility: hidden; transform: translateY(-10px); transition: all 0.2s ease; z-index: 1001;">
                        
                        <div style="padding: 0.5rem;">
                            <a href="/trust" 
                               role="menuitem" 
                               class="{{ nav_class(request, '/trust', base_classes='nav-dropdown-item') }}"
                               style="display: block; padding: 0.75rem 1rem; color: #374151; text-decoration: none; border-radius: 0.375rem; transition: background-color 0.2s ease; font-weight: 500;"
                               onmouseover="this.style.backgroundColor='#f3f4f6'"
                               onmouseout="this.style.backgroundColor='transparent'">
                                üõ°Ô∏è Security & Trust
                            </a>
                            
                            <div style="border-top: 1px solid #f3f4f6; margin: 0.5rem 0;"></div>
                            
                            <a href="/legal/privacy" 
                               role="menuitem" 
                               class="{{ nav_class(request, '/legal/privacy', base_classes='nav-dropdown-item') }}"
                               style="display: block; padding: 0.75rem 1rem; color: #374151; text-decoration: none; border-radius: 0.375rem; transition: background-color 0.2s ease; font-weight: 500;"
                               onmouseover="this.style.backgroundColor='#f3f4f6'"
                               onmouseout="this.style.backgroundColor='transparent'">
                                üìã Privacy Policy
                            </a>
                            
                            <a href="/legal/terms" 
                               role="menuitem" 
                               class="{{ nav_class(request, '/legal/terms', base_classes='nav-dropdown-item') }}"
                               style="display: block; padding: 0.75rem 1rem; color: #374151; text-decoration: none; border-radius: 0.375rem; transition: background-color 0.2s ease; font-weight: 500;"
                               onmouseover="this.style.backgroundColor='#f3f4f6'"
                               onmouseout="this.style.backgroundColor='transparent'">
                                üìÑ Terms of Service
                            </a>
                            
                            <a href="/legal/imprint" 
                               role="menuitem" 
                               class="{{ nav_class(request, '/legal/imprint', base_classes='nav-dropdown-item') }}"
                               style="display: block; padding: 0.75rem 1rem; color: #374151; text-decoration: none; border-radius: 0.375rem; transition: background-color 0.2s ease; font-weight: 500;"
                               onmouseover="this.style.backgroundColor='#f3f4f6'"
                               onmouseout="this.style.backgroundColor='transparent'">
                                ‚öñÔ∏è Legal Imprint
                            </a>
                        </div>
                    </div>
                </div>
                
                <!-- Authentication Links -->
                {% if request.state.user %}
                    <div class="auth-user" style="display: flex; align-items: center; gap: 0.5rem;">
                        <span style="color: rgba(255, 255, 255, 0.8); font-size: 0.9rem;">
                            {{ request.state.user.email }} ({{ request.state.user.role.upper() }})
                        </span>
                        <form method="POST" action="/auth/logout" style="display: inline;">
                            <button type="submit" 
                                    style="background: rgba(255, 255, 255, 0.1); color: white; border: 1px solid rgba(255, 255, 255, 0.2); padding: 0.5rem 0.75rem; border-radius: 0.375rem; cursor: pointer; font-size: 0.9rem; transition: all 0.2s ease;"
                                    onmouseover="this.style.background='rgba(255, 255, 255, 0.2)'"
                                    onmouseout="this.style.background='rgba(255, 255, 255, 0.1)'">
                                üö™ Logout
                            </button>
                        </form>
                    </div>
                {% else %}
                    <a href="/auth/login" 
                       class="{{ nav_class(request, '/auth/login', base_classes='nav-link') }}"
                       style="color: rgba(255, 255, 255, 0.9); text-decoration: none; padding: 0.5rem 0.75rem; border-radius: 0.375rem; font-weight: 500; transition: all 0.2s ease;"
                       onmouseover="this.style.color='white'; this.style.backgroundColor='rgba(255, 255, 255, 0.1)'"
                       onmouseout="this.style.color='rgba(255, 255, 255, 0.9)'; this.style.backgroundColor='transparent'">
                        üîê Login
                    </a>
                {% endif %}
            </div>
        </div>

        <!-- Mobile Menu Toggle (for future responsive enhancement) -->
        <button 
            type="button" 
            class="nav-mobile-toggle" 
            aria-label="Toggle navigation menu"
            style="display: none; background: rgba(255, 255, 255, 0.1); color: white; border: 1px solid rgba(255, 255, 255, 0.2); padding: 0.5rem; border-radius: 0.375rem; cursor: pointer;"
            onclick="toggleMobileMenu()">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"/>
            </svg>
        </button>
    </div>
</nav>

<!-- Enhanced Navigation Styles -->
<style>
/* Active state styling */
.nav-link.active,
.nav-dropdown-item.active,
.nav-dropdown-toggle.active {
    background: rgba(255, 255, 255, 0.2) !important;
    color: white !important;
}

.nav-dropdown-item.active {
    background: #667eea !important;
    color: white !important;
}

.nav-dropdown-toggle.active {
    background: rgba(255, 255, 255, 0.2) !important;
    border-color: rgba(255, 255, 255, 0.4) !important;
}

/* Responsive design */
@media (max-width: 768px) {
    .nav-primary {
        display: none;
    }
    
    .nav-mobile-toggle {
        display: block !important;
    }
    
    .nav-dropdown-menu {
        position: fixed !important;
        top: 60px !important;
        left: 1rem !important;
        right: 1rem !important;
        width: auto !important;
        min-width: auto !important;
    }
}

/* Focus states for accessibility */
.nav-dropdown-toggle:focus-visible,
.nav-link:focus-visible,
.nav-dropdown-item:focus-visible {
    outline: 2px solid #0050FF;
    outline-offset: 2px;
    border-radius: 4px;
}

/* Dropdown animation states */
.nav-dropdown-menu.show {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
}

.nav-dropdown-toggle[aria-expanded="true"] .dropdown-arrow {
    transform: rotate(180deg);
}
</style>

<!-- Navigation JavaScript -->
<script{% if get_nonce(request) %} nonce="{{ get_nonce(request) }}"{% endif %}>
// Dropdown toggle functionality
function toggleDropdown(menuId, toggleButton) {
    const menu = document.getElementById(menuId);
    const isOpen = toggleButton.getAttribute('aria-expanded') === 'true';
    
    // Close all other dropdowns first
    document.querySelectorAll('.nav-dropdown-menu').forEach(dropdown => {
        dropdown.classList.remove('show');
    });
    document.querySelectorAll('.nav-dropdown-toggle').forEach(toggle => {
        toggle.setAttribute('aria-expanded', 'false');
    });
    
    if (!isOpen) {
        menu.classList.add('show');
        toggleButton.setAttribute('aria-expanded', 'true');
    }
}

// Close dropdown when clicking outside
document.addEventListener('click', function(event) {
    if (!event.target.closest('.nav-dropdown')) {
        document.querySelectorAll('.nav-dropdown-menu').forEach(dropdown => {
            dropdown.classList.remove('show');
        });
        document.querySelectorAll('.nav-dropdown-toggle').forEach(toggle => {
            toggle.setAttribute('aria-expanded', 'false');
        });
    }
});

// Close dropdown on escape key
document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        document.querySelectorAll('.nav-dropdown-menu').forEach(dropdown => {
            dropdown.classList.remove('show');
        });
        document.querySelectorAll('.nav-dropdown-toggle').forEach(toggle => {
            toggle.setAttribute('aria-expanded', 'false');
        });
    }
});

// Mobile menu toggle (placeholder for future implementation)
function toggleMobileMenu() {
    const primaryNav = document.querySelector('.nav-primary');
    // Implementation would go here for mobile menu
    console.log('Mobile menu toggle - to be implemented');
}

// Keyboard navigation for dropdown
document.addEventListener('keydown', function(event) {
    if (event.target.closest('.nav-dropdown')) {
        const dropdown = event.target.closest('.nav-dropdown');
        const toggle = dropdown.querySelector('.nav-dropdown-toggle');
        const menu = dropdown.querySelector('.nav-dropdown-menu');
        const items = menu.querySelectorAll('.nav-dropdown-item');
        
        if (event.key === 'ArrowDown' && toggle.getAttribute('aria-expanded') === 'true') {
            event.preventDefault();
            items[0]?.focus();
        } else if (event.key === 'ArrowUp' && toggle.getAttribute('aria-expanded') === 'true') {
            event.preventDefault();
            items[items.length - 1]?.focus();
        }
    }
});
</script>
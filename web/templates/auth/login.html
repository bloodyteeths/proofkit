{% extends "modern_base.html" %}

{% block title %}Login - ProofKit{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="hero" style="padding: 3rem 0;">
    <div class="hero-container">
        <div style="text-align: center; max-width: 600px; margin: 0 auto;">
            <div style="display: inline-flex; align-items: center; gap: 0.5rem; background: rgba(255, 255, 255, 0.2); padding: 0.5rem 1rem; border-radius: 2rem; margin-bottom: 1.5rem;">
                <span style="font-size: 1.5rem;">üîê</span>
                <span style="font-weight: 600;">Secure Authentication</span>
            </div>
            
            <h1 style="font-size: 2.5rem; font-weight: 700; margin-bottom: 1rem;">
                Welcome Back to<br>
                <span class="highlight">ProofKit</span>
            </h1>
            
            <p style="font-size: 1.25rem; opacity: 0.9; margin-bottom: 2rem; line-height: 1.6;">
                Enter your email to receive a secure magic link for instant access
            </p>
        </div>
    </div>
</section>

<!-- Login Form Section -->
<section class="section">
    <div class="section-container" style="max-width: 500px; margin: 0 auto;">
        <div class="card" style="padding: 2rem;">
            <form method="POST" action="/auth/request-link" id="login-form">
                <div style="margin-bottom: 1.5rem;">
                    <label for="email" style="font-weight: 600; color: #374151; margin-bottom: 0.5rem; display: block;">
                        üìß Email Address
                    </label>
                    <input type="email" id="email" name="email" placeholder="your.email@company.com" required
                           style="width: 100%; padding: 0.75rem; border: 2px solid #e2e8f0; border-radius: 0.5rem; font-size: 1rem; transition: all 0.2s;">
                    <small style="color: #6b7280; font-size: 0.875rem;">We'll send a secure login link to this address</small>
                </div>

                <div style="margin-bottom: 2rem;">
                    <label for="role" style="font-weight: 600; color: #374151; margin-bottom: 0.5rem; display: block;">
                        üë§ Access Role
                    </label>
                    <select id="role" name="role" required
                            style="width: 100%; padding: 0.75rem; border: 2px solid #e2e8f0; border-radius: 0.5rem; font-size: 1rem; transition: all 0.2s; background: white;">
                        <option value="op">Operator (OP) - Process validations</option>
                        <option value="qa">Quality Assurance (QA) - Approve results</option>
                    </select>
                    <small style="color: #6b7280; font-size: 0.875rem;">Select your role to access the appropriate features</small>
                </div>

                <button type="submit" class="btn btn-primary" style="width: 100%; font-size: 1.1rem; padding: 1rem;">
                    üìß Send Magic Link
                </button>
            </form>

            <div id="status-message" style="display: none; margin-top: 1.5rem;"></div>
        </div>

        <!-- Info Section -->
        <div class="card" style="margin-top: 2rem; background: #f7fafc; border: 1px solid #e2e8f0;">
            <h3 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 1rem; color: #1a1a1a; display: flex; align-items: center; gap: 0.5rem;">
                üõ°Ô∏è About Magic Link Authentication
            </h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                <div style="padding: 1rem; background: white; border-radius: 0.5rem;">
                    <h4 style="color: #667eea; font-weight: 600; margin-bottom: 0.5rem;">üîí Secure</h4>
                    <p style="color: #6b7280; font-size: 0.9rem;">No passwords stored - each link is single-use and time-limited</p>
                </div>
                <div style="padding: 1rem; background: white; border-radius: 0.5rem;">
                    <h4 style="color: #48bb78; font-weight: 600; margin-bottom: 0.5rem;">‚ö° Fast</h4>
                    <p style="color: #6b7280; font-size: 0.9rem;">Click the link in your email to instantly access ProofKit</p>
                </div>
                <div style="padding: 1rem; background: white; border-radius: 0.5rem;">
                    <h4 style="color: #f59e0b; font-weight: 600; margin-bottom: 0.5rem;">üë• Role-based</h4>
                    <p style="color: #6b7280; font-size: 0.9rem;">Operators process files, QA approves results</p>
                </div>
                <div style="padding: 1rem; background: white; border-radius: 0.5rem;">
                    <h4 style="color: #ef4444; font-weight: 600; margin-bottom: 0.5rem;">‚è±Ô∏è Time-limited</h4>
                    <p style="color: #6b7280; font-size: 0.9rem;">Links expire after 15 minutes for security</p>
                </div>
            </div>
        </div>

        <!-- Alternative Actions -->
        <div style="text-align: center; margin-top: 2rem; padding-top: 2rem; border-top: 1px solid #e5e7eb;">
            <p style="color: #6b7280; margin-bottom: 1rem;">New to ProofKit?</p>
<a href="/auth/get-started" class="btn btn-secondary" style="margin-right: 1rem;">
                Create Account
            </a>
            <a href="/pricing" style="color: #667eea; text-decoration: none;">
                View Pricing ‚Üí
            </a>
        </div>
    </div>
</section>

<style>
input:focus, select:focus {
    outline: none;
    border-color: #667eea !important;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

.btn:hover {
    transform: translateY(-2px);
}

.success-message {
    background: #d1fae5;
    border: 1px solid #a7f3d0;
    color: #065f46;
    padding: 1rem;
    border-radius: 0.5rem;
    margin-top: 1rem;
}

.error-message {
    background: #fef2f2;
    border: 1px solid #fecaca;
    color: #dc2626;
    padding: 1rem;
    border-radius: 0.5rem;
    margin-top: 1rem;
}

.dev-link-box {
    margin: 1rem 0;
    padding: 1rem;
    background: #f0f4ff;
    border: 1px solid #667eea;
    border-radius: 0.5rem;
    word-break: break-all;
}
</style>

{% block scripts %}
<script{% if get_nonce(request) %} nonce="{{ get_nonce(request) }}"{% endif %}>
document.getElementById('login-form').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const form = e.target;
    const submitBtn = form.querySelector('button[type="submit"]');
    const statusDiv = document.getElementById('status-message');
    
    // Disable form and show loading
    submitBtn.disabled = true;
    submitBtn.innerHTML = '‚è≥ Sending...';
    statusDiv.style.display = 'none';
    
    try {
        const formData = new FormData(form);
        const response = await fetch('/auth/request-link', {
            method: 'POST',
            body: formData
        });
        
        const result = await response.json();
        
        if (response.ok) {
            let statusHtml = '<div class="success-message">';
            statusHtml += '<h4 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 0.5rem;">‚úÖ Magic Link Sent!</h4>';
            statusHtml += '<p style="margin-bottom: 0.5rem;">' + result.message + '</p>';
            
            // Show actual link in development mode
            if (result.dev_link) {
                statusHtml += '<div class="dev-link-box">';
                statusHtml += '<strong>üîó Development Magic Link:</strong><br>';
                statusHtml += '<a href="' + result.dev_link + '" target="_blank" style="color: #667eea; word-break: break-all;">' + result.dev_link + '</a>';
                statusHtml += '<br><small style="color: #6b7280;">‚ö†Ô∏è This link expires in 15 minutes</small>';
                statusHtml += '</div>';
            } else {
                statusHtml += '<p style="color: #059669; font-size: 0.9rem;">Check your email and click the link to access ProofKit.</p>';
            }
            
            statusHtml += '</div>';
            statusDiv.innerHTML = statusHtml;
            form.reset();
        } else {
            throw new Error(result.detail || 'Failed to send magic link');
        }
    } catch (error) {
        statusDiv.innerHTML = '<div class="error-message">' +
            '<h4 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 0.5rem;">‚ùå Error</h4>' +
            '<p>' + error.message + '</p>' +
            '</div>';
    } finally {
        statusDiv.style.display = 'block';
        submitBtn.disabled = false;
        submitBtn.innerHTML = 'üìß Send Magic Link';
    }
});
</script>
{% endblock %}
{% endblock %}